{{- if .Values.secrets.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ default (include "operately.fullname" .) .Values.secrets.name }}
  labels:
    {{- include "operately.labels" . | nindent 4 }}
type: Opaque
stringData:
  SECRET_KEY_BASE: {{ include "operately.secretKeyBase" . | quote }}
  OPERATELY_BLOB_TOKEN_SECRET_KEY: {{ include "operately.blobTokenSecretKey" . | quote }}
  {{- if not .Values.externalPostgresql.existingSecret }}
  DATABASE_URL: {{ required "Database must be configured via externalPostgresql or postgresql.enabled" (include "operately.database.url" .) | quote }}
  {{- end }}
{{- end }}
